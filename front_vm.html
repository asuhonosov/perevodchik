<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Диалоговый ассистент</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: light;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #edf5ff, #f7fbff 65%, #f6f4ff);
      color: #1c2635;
    }

    main {
      max-width: 1200px;
      margin: 40px auto;
      background: #ffffffee;
      backdrop-filter: blur(12px);
      border-radius: 24px;
      padding: 36px;
      box-shadow: 0 20px 60px rgba(76, 105, 158, 0.15);
    }

    h1 {
      margin: 0 0 24px;
      font-size: 32px;
      letter-spacing: -0.02em;
    }

    p.subtitle {
      margin: -12px 0 32px;
      color: #516079;
      font-size: 15px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      align-items: center;
      margin-bottom: 28px;
    }

    label {
      font-size: 15px;
      font-weight: 600;
      color: #263247;
    }

    select {
      margin-left: 8px;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid #d4dff3;
      font-size: 14px;
      background: #fff;
      min-width: 200px;
    }

    .buttons-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      width: 100%;
    }

    button {
      appearance: none;
      border: 0;
      border-radius: 14px;
      padding: 14px 18px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: #f2f6ff;
      color: #283552;
      box-shadow: inset 0 0 0 1px rgba(104, 128, 182, 0.25);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(72, 102, 164, 0.18);
    }

    button.active {
      background: linear-gradient(135deg, #4f8cff, #678bff);
      color: white;
      box-shadow: 0 14px 30px rgba(76, 108, 202, 0.28);
    }

    .status-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 28px;
      color: #5c6881;
      font-size: 14px;
    }

    .status-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 999px;
      background: #edf1fb;
      border: 1px solid #d7e2ff;
    }

    .status-chip.on {
      background: #e6f7f1;
      border-color: #bce8d6;
      color: #147b52;
    }

    .split-pane {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 28px;
    }

    .pane {
      display: flex;
      flex-direction: column;
      gap: 16px;
      background: #f7f9ff;
      border-radius: 20px;
      padding: 22px;
      border: 1px solid rgba(167, 188, 235, 0.4);
      min-height: 520px;
    }

    .pane h2 {
      margin: 0;
      font-size: 18px;
      letter-spacing: -0.01em;
    }

    .dialog-list {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
      overflow-y: auto;
    }

    .bubble {
      max-width: 90%;
      padding: 14px 16px;
      border-radius: 18px;
      line-height: 1.4;
      background: #ffffff;
      color: #202d45;
      box-shadow: 0 10px 26px rgba(61, 92, 152, 0.12);
    }

    .bubble.from-foreign {
      align-self: flex-start;
      border-bottom-left-radius: 6px;
      background: linear-gradient(135deg, #4f8cff, #6c9cff);
      color: white;
    }

    .bubble.from-russian {
      align-self: flex-end;
      border-bottom-right-radius: 6px;
      background: #fff;
    }

    .empty-state {
      margin: auto;
      text-align: center;
      color: #7784a5;
      font-size: 15px;
      max-width: 240px;
    }

    .empty-state strong {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }

    @media (max-width: 640px) {
      main { padding: 24px 18px; border-radius: 0; margin: 0; }
      h1 { font-size: 26px; }
      button { font-size: 14px; }
      select { min-width: 160px; }
    }
  </style>
</head>
<body>
  <main>
    <h1>Голосовой ассистент переводчика</h1>
    <p class="subtitle">Выберите язык собеседника и управляйте записью каждой реплики. Диалог отображается отдельно на выбранном языке и на русском.</p>

    <section class="controls">
      <label>
        Язык собеседника
        <select id="languageSelect" aria-label="Выбор языка собеседника">
          <option value="kk" data-display="Казахский">Қазақ тілі (Казахский)</option>
          <option value="en" data-display="Английский">English (Английский)</option>
          <option value="uz" data-display="Узбекский">O‘zbek tili (Узбекский)</option>
          <option value="ky" data-display="Киргизский">Кыргызча (Киргизский)</option>
          <option value="de" data-display="Немецкий">Deutsch (Немецкий)</option>
          <option value="zh" data-display="Китайский">中文 (Китайский)</option>
        </select>
      </label>
    </section>

    <div class="buttons-grid">
      <button id="foreignStartBtn">▶︎ Вкл запись на выбранном языке</button>
      <button id="foreignStopBtn">■ Выкл запись на выбранном языке</button>
      <button id="russianStartBtn">▶︎ Вкл запись на русском</button>
      <button id="russianStopBtn">■ Выкл запись на русском</button>
    </div>

    <div class="status-row" aria-live="polite">
      <span id="foreignStatus" class="status-chip">Иностранный собеседник: ожидание</span>
      <span id="russianStatus" class="status-chip">Русский собеседник: ожидание</span>
    </div>

    <section class="split-pane" aria-label="Диалоги">
      <div class="pane" aria-live="polite" aria-label="Диалог на выбранном языке">
        <h2 id="foreignPaneTitle">Диалог на казахском</h2>
        <div id="foreignDialog" class="dialog-list">
          <div class="empty-state">
            <strong>Пока что пусто</strong>
            Нажмите «Вкл запись» для начала новой реплики.
          </div>
        </div>
      </div>

      <div class="pane" aria-live="polite" aria-label="Диалог на русском языке">
        <h2>Диалог на русском</h2>
        <div id="russianDialog" class="dialog-list">
          <div class="empty-state">
            <strong>Пока что пусто</strong>
            После завершения реплики перевод появится здесь.
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const languageSelect = document.getElementById('languageSelect');
    const foreignStartBtn = document.getElementById('foreignStartBtn');
    const foreignStopBtn = document.getElementById('foreignStopBtn');
    const russianStartBtn = document.getElementById('russianStartBtn');
    const russianStopBtn = document.getElementById('russianStopBtn');
    const foreignStatus = document.getElementById('foreignStatus');
    const russianStatus = document.getElementById('russianStatus');
    const foreignDialog = document.getElementById('foreignDialog');
    const russianDialog = document.getElementById('russianDialog');
    const foreignPaneTitle = document.getElementById('foreignPaneTitle');

    let isForeignRecording = false;
    let isRussianRecording = false;

    const conversation = [];

    languageSelect.addEventListener('change', () => {
      const option = languageSelect.options[languageSelect.selectedIndex];
      foreignPaneTitle.textContent = `Диалог на ${option.dataset.display.toLowerCase()}`;
      if (isForeignRecording) {
        foreignStatus.textContent = `${option.dataset.display}: запись идёт…`;
      }
    });

    function updateStatus(chip, isRecording, label) {
      chip.classList.toggle('on', isRecording);
      chip.textContent = isRecording ? `${label}: запись идёт…` : `${label}: ожидание`;
    }

    function toggleButtonState(button, isActive) {
      button.classList.toggle('active', isActive);
      button.disabled = isActive;
    }

    function ensureDialogPlaceholder(container) {
      if (!container.querySelector('.bubble') && !container.querySelector('.empty-state')) {
        const empty = document.createElement('div');
        empty.className = 'empty-state';
        empty.innerHTML = '<strong>Пока что пусто</strong>Нажмите «Вкл запись» для начала новой реплики.';
        container.appendChild(empty);
      }
    }

    function clearPlaceholders() {
      [foreignDialog, russianDialog].forEach(container => {
        const empty = container.querySelector('.empty-state');
        if (empty) empty.remove();
      });
    }

    function renderConversation() {
      foreignDialog.innerHTML = '';
      russianDialog.innerHTML = '';

      if (conversation.length === 0) {
        ensureDialogPlaceholder(foreignDialog);
        ensureDialogPlaceholder(russianDialog);
        return;
      }

      conversation.forEach(entry => {
        const foreignBubble = document.createElement('div');
        foreignBubble.className = 'bubble ' + (entry.direction === 'foreign' ? 'from-foreign' : 'from-russian');
        foreignBubble.textContent = entry.foreignText || '—';

        const russianBubble = document.createElement('div');
        russianBubble.className = 'bubble ' + (entry.direction === 'russian' ? 'from-russian' : 'from-foreign');
        russianBubble.textContent = entry.russianText || '—';

        foreignDialog.appendChild(foreignBubble);
        russianDialog.appendChild(russianBubble);
      });
    }

    function promptReplica(direction) {
      const languageName = languageSelect.options[languageSelect.selectedIndex].dataset.display;
      const isForeign = direction === 'foreign';

      const originalPrompt = isForeign
        ? `Введите текст реплики на ${languageName.toLowerCase()}:`
        : 'Введите текст реплики на русском:';
      const translationPrompt = isForeign
        ? 'Введите перевод реплики на русский:'
        : `Введите перевод реплики на ${languageName.toLowerCase()}:`;

      const originalText = window.prompt(originalPrompt, '');
      if (originalText === null) {
        return; // отмена ввода
      }

      const translatedText = window.prompt(translationPrompt, '');
      if (translatedText === null) {
        return; // отмена ввода
      }

      const entry = {
        direction,
        foreignText: isForeign ? originalText.trim() : translatedText.trim(),
        russianText: isForeign ? translatedText.trim() : originalText.trim()
      };

      conversation.push(entry);
      clearPlaceholders();
      renderConversation();
    }

    foreignStartBtn.addEventListener('click', () => {
      if (isForeignRecording) return;
      isForeignRecording = true;
      toggleButtonState(foreignStartBtn, true);
      foreignStopBtn.disabled = false;
      updateStatus(foreignStatus, true, languageSelect.options[languageSelect.selectedIndex].dataset.display);
    });

    foreignStopBtn.addEventListener('click', () => {
      if (!isForeignRecording) return;
      isForeignRecording = false;
      toggleButtonState(foreignStartBtn, false);
      updateStatus(foreignStatus, false, languageSelect.options[languageSelect.selectedIndex].dataset.display);
      promptReplica('foreign');
    });

    russianStartBtn.addEventListener('click', () => {
      if (isRussianRecording) return;
      isRussianRecording = true;
      toggleButtonState(russianStartBtn, true);
      russianStopBtn.disabled = false;
      updateStatus(russianStatus, true, 'Русский собеседник');
    });

    russianStopBtn.addEventListener('click', () => {
      if (!isRussianRecording) return;
      isRussianRecording = false;
      toggleButtonState(russianStartBtn, false);
      updateStatus(russianStatus, false, 'Русский собеседник');
      promptReplica('russian');
    });

    foreignStopBtn.disabled = true;
    russianStopBtn.disabled = true;

    ensureDialogPlaceholder(foreignDialog);
    ensureDialogPlaceholder(russianDialog);
  </script>
</body>
</html>
